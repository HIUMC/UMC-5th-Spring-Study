1. í”„ë¡œì íŠ¸ í™˜ê²½ì„¤ì •
   1. [í”„ë¡œì íŠ¸ ìƒì„±](#í”„ë¡œì íŠ¸-ìƒì„±)
   2. [ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚´í´ë³´ê¸°](#ë¼ì´ë¸ŒëŸ¬ë¦¬-ì‚´í´ë³´ê¸°)
   3. [View í™˜ê²½ì„¤ì •](#view-í™˜ê²½ì„¤ì •)
   4. [ë¹Œë“œí•˜ê³  ì‹¤í–‰í•˜ê¸°](#ë¹Œë“œí•˜ê³ -ì‹¤í–‰í•˜ê¸°)
2. ìŠ¤í”„ë§ ì›¹ ê°œë°œ ê¸°ì´ˆ
   1. [ì •ì  ì»¨í…ì¸ ](#ì •ì -ì»¨í…ì¸ )
   2. [MVCì™€ í…œí”Œë¦¿ ì—”ì§„](#mvcì™€-í…œí”Œë¦¿-ì—”ì§„)
   3. [API](#api)
3. íšŒì› ê´€ë¦¬ ì˜ˆì œ - ë°±ì—”ë“œ ê°œë°œ
   1. [ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬](#ë¹„ì¦ˆë‹ˆìŠ¤-ìš”êµ¬ì‚¬í•­-ì •ë¦¬)
   2. [íšŒì› ë„ë©”ì¸ê³¼ ë¦¬í¬ì§€í† ë¦¬ ë§Œë“¤ê¸°](#íšŒì›-ë„ë©”ì¸ê³¼-ë¦¬í¬ì§€í† ë¦¬-ë§Œë“¤ê¸°)
   3. [íšŒì› ë¦¬í”„ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±](#íšŒì›-ë¦¬í¬ì§€í† ë¦¬-í…ŒìŠ¤íŠ¸-ì¼€ì´ìŠ¤-ì‘ì„±)
   4. [íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ](#íšŒì›-ì„œë¹„ìŠ¤-ê°œë°œ)
   5. [íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸](#íšŒì›-ì„œë¹„ìŠ¤-í…ŒìŠ¤íŠ¸)
4. ìŠ¤í”„ë§ ë¹ˆê³¼ ì˜ì¡´ê´€ê³„
   1. [ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ê³¼ ìë™ ì˜ì¡´ê´€ê³„ ì„¤ì •](#ì»´í¬ë„ŒíŠ¸-ìŠ¤ìº”ê³¼-ìë™-ì˜ì¡´ê´€ê³„-ì„¤ì •)
   2. [ìë°” ì½”ë“œë¡œ ì§ì ‘ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡í•˜ê¸°](#ìë°”-ì½”ë“œë¡œ-ì§ì ‘-ìŠ¤í”„ë§-ë¹ˆ-ë“±ë¡í•˜ê¸°)
5. íšŒì› ê´€ë¦¬ ì˜ˆì œ - ì›¹ MVC ê°œë°œ
   1. [íšŒì› ì›¹ ê¸°ëŠ¥ - í™ˆ í™”ë©´ ì¶”ê°€](#íšŒì›-ì›¹-ê¸°ëŠ¥---í™ˆ-í™”ë©´-ì¶”ê°€)
   2. [íšŒì› ì›¹ ê¸°ëŠ¥ - ë“±ë¡](#íšŒì›-ì›¹-ê¸°ëŠ¥---ì¡°íšŒ)
   3. [íšŒì› ì›¹ ê¸°ëŠ¥ - ì¡°íšŒ](#íšŒì›-ì›¹-ê¸°ëŠ¥---ì¡°íšŒ)
6. ìŠ¤í”„ë§ DB ì ‘ê·¼ ê¸°ìˆ 
   1. [H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜](#h2-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ì¹˜)
   2. [ìˆœìˆ˜ Jdbc](#ìˆœìˆ˜-jdbc)
   3. [ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸](#ìŠ¤í”„ë§-í†µí•©-í…ŒìŠ¤íŠ¸)
   4. [ìŠ¤í”„ë§ JdbcTemplate](#ìŠ¤í”„ë§-jdbctemplate)
   5. [JPA](#jpa)
   6. [ìŠ¤í”„ë§ ë°ì´í„° JPA](#ìŠ¤í”„ë§-ë°ì´í„°-jpa)
7. AOP
   1. [AOPê°€ í•„ìš”í•œ ìƒí™©](#aop-ê°€-í•„ìš”í•œ-ìƒí™©)
   2. [AOP ì ìš©](#aop-ì ìš©)


# í”„ë¡œì íŠ¸ ìƒì„±

- ì‚¬ì „ ì¤€ë¹„ë¬¼
    - Java 11 ì„¤ì¹˜
    - IDE : IntelliJ ë˜ëŠ” Eclipse ì„¤ì¹˜

### ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ ìƒì„±í•˜ê¸° 
âœ… [ìŠ¤í”„ë§ ë¶€íŠ¸ ìŠ¤íƒ€í„° ì‚¬ì´íŠ¸](https://start.spring.io)ë¡œ ì´ë™í•˜ê¸°

    âš ï¸ ì£¼ì˜ âš ï¸ ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì‚¬ìš© ì‹œ

    1. Java 17 ì´ìƒ ì‚¬ìš©
    2. javax íŒ¨í‚¤ì§€ ì´ë¦„ â†’ jakarta ë¡œ ë³€ê²½
    3. H2 ë°ì´í„°ë² ì´ìŠ¤ 2.1.214 ë²„ì „ ì´ìƒ ì‚¬ìš©

- í”„ë¡œì íŠ¸ ì„ íƒ
  - Project : Gradle - Groovy Project
  - Spring Boot : 2.3.x
  - Language : Java
  - Packaging : Jar
  - Java : 11
- Project Metadata
  - groupId : hello
  - artifactId : hello-spring
- Dependencies : Spring Web, Thymeleaf

  ![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbrWWU2%2FbtssTr9JgWb%2F7fjKnpDSNcEugAVOj9wcY0%2Fimg.png)
 

âœ… IntelliJ ì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±í•˜ê¸°
1. ìŠ¤í”„ë§ ë¶€íŠ¸ ìŠ¤íƒ€í„° ì‚¬ì´íŠ¸ì—ì„œ GENERATE â†’ í´ë” ìƒì„±
2. IntelliJë¡œ í´ë” ì—´ê¸°
3. Settings - Build, Execution, Deployment - Gradle ì„¤ì • ë³€ê²½
    1. Build and run using : Gradle â†’ IntelliJ IDEA
    2. Run tests using : Gradle â†’ IntelliJ IDEA

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcI1j3z%2FbtssLDxrt2f%2FVKqS6mitf2pcgGk7aWoTbK%2Fimg.png)

4. Run

- ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
```java
package hello.hellospring;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class HelloSpringApplication {

	public static void main(String[] args) {
		SpringApplication.run(HelloSpringApplication.class, args);
		// ì‹¤í–‰í•˜ë ¤ëŠ” í´ë˜ìŠ¤ ì´ë¦„ ì¨ì£¼ê¸°
	}
}
```

### í†°ìº£ ì„œë²„ ì‹¤í–‰ í™•ì¸í•˜ê¸°
âœ… ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8080 ìœ¼ë¡œ í†°ìº£ ì„œë²„ ì‹¤í–‰ í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FkOPo6%2FbtssJl4Bn9Y%2FTp43qwyaRryrCbSkj5nAGK%2Fimg.png)

â†’ ì´ë ‡ê²Œ ë‚˜ì˜¤ë©´ ì„±ê³µ

- ì‹¤í–‰ ë©ˆì·„ì„ ë•Œ í†°ìº£ ì„œë²„

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F5pNzD%2FbtssLJj7MuS%2Fkwb4W7rsLsHiCGUX9Fk080%2Fimg.png)

â†’ ì—°ê²° ì•ˆë¨

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚´í´ë³´ê¸°

- build.gradle - dependencies
- External Libraries

â†’ ì´ì „ê³¼ ë‹¤ë¥´ê²Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì›¹ ì„œë²„ (WAS) ë‚´ì¥ë˜ì–´ ìˆìŒ

### ìŠ¤í”„ë§ ë¶€íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ 

- spring-boot-starter-web
    - spring-boot-starter-tomcat : í†°ìº£ (ì›¹ì„œë²„)
    - spring-webmvc : ìŠ¤í”„ë§ ì›¹ MVC
- spring-boot-starter-thymeleaf : íƒ€ì„ë¦¬í”„ í…œí”Œë¦¿ ì—”ì§„ (View)
- spring-boot-starter (ê³µí†µ) : ìŠ¤í”„ë§ ë¶€íŠ¸ + ìŠ¤í”„ë§ ì½”ì–´ + ë¡œê¹…
    - spring-boot
        - spring-core
    - spring-boot-starter-logging
        - logback, slf4j


### í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬

- spring-boot-starter-test
    - junit : í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
    - mockito :  ëª© ë¼ì´ë¸ŒëŸ¬ë¦¬
    - assertj : í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¢€ ë” í¸í•˜ê²Œ ì‘ì„±í•˜ê²Œ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
    - spring-test : ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸ ì§€ì›

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# View í™˜ê²½ì„¤ì •

### Welcome Page ë§Œë“¤ê¸°

âœ… src - resources - static - index.html ìƒì„±
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
Hello
<a href="/hello">hello</a>
</body>
</html>
```

âœ… ì›¹ ë¸Œë¼ìš°ì € ì ‘ì† (http://localhost:8080)

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbkH23a%2Fbtss3F9nvam%2F1PkOIi9AczPVlv92k1XL70%2Fimg.png)

â†’ ì„±ê³µ (ì •ì  í˜ì´ì§€)

- https://spring.io/ ì ‘ì†í•´ì„œ ì‘ë™ ë°©ì‹ ì‚´í´ë³´ê¸°
    - Projects - Spring Boot - Learn - Spring Boot Features - 7. Developing Web Applications - 7.1.6. Welcome Page

### Thymeleaf í…œí”Œë¦¿ ì—”ì§„

- [thymeleaf ê³µì‹ ì‚¬ì´íŠ¸](https://www.thymeleaf.org/)
- [ìŠ¤í”„ë§ ê³µì‹ íŠœí† ë¦¬ì–¼](https://spring.io/guides/gs/serving-web-content/)
- [ìŠ¤í”„ë§ë¶€íŠ¸ ë©”ë‰´ì–¼](https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/html/spring-boot-features.html#boot-features-spring-mvc-template-engines)

1. Controller ìƒì„±
    1. src/main/java/hello.hellospring ì— controller package ìƒì„±
    2. controller package ë°‘ì— HelloController í´ë˜ìŠ¤ ìƒì„±

```java
package hello.hellospring.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HelloController {

    @GetMapping("hello")
    public String hello(Model model) {
        // key: data , value: hello!!
        // hello.html ì—ì„œ ${data} í˜¸ì¶œ ì‹œ hello!! ë°˜í™˜
        model.addAttribute("data", "hello!!");

        // return ê°’ì€ src/resources/templates ë‚´ html ì˜ ì´ë¦„ê³¼ ê°™ì•„ì•¼ í•¨ : rendering
        return "hello";
    }
}
```

2. src/resources/templates ì— hello.html ìƒì„±

```html
<!DOCTYPE html>
<!-- thymeleaf ë¬¸ë²• ì‚¬ìš© ê°€ëŠ¥ -->
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
<!-- key ê°’ì´ data ì¸ value ë°˜í™˜ : hello!! (HelloController ì—ì„œ ì •ì˜) -->
<p th:text="'ì•ˆë…•í•˜ì„¸ìš”. ' + ${data}">ì•ˆë…•í•˜ì„¸ìš”. ì†ë‹˜</p>
</body>
</html>
```

3. ì›¹ ë¸Œë¼ìš°ì € í™•ì¸
- GetMapping

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FKfnJL%2Fbtss91X6CZN%2FA4DLJdTKvTq8bqU6nxTSPK%2Fimg.png)

- ì›¹ì—ì„œ HTML í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fx6owd%2Fbtss8lvZKh9%2F5GcRokQM3hCKmcIpsBxLY1%2Fimg.png)

â†’ hello!! ë¡œ ë°”ë€Œì–´ ìˆë‹¤

- ë™ì‘ í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fce0FAZ%2Fbtss70Fy6jF%2FaGuifE6uvxRRKIkH8N3vb1%2Fimg.png)

â†’ Controller ì—ì„œ return ê°’ìœ¼ë¡œ ë¬¸ì ë°˜í™˜ ì‹œ viewResolver ê°€ í™”ë©´ì„ ì°¾ì•„ ì²˜ë¦¬

- ìŠ¤í”„ë§ ë¶€íŠ¸ í…œí”Œë¦¿ ì—”ì§„ ê¸°ë³¸ viewName ë§¤í•‘
- resources:templates/ + {ViewName} + .html

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ë¹Œë“œí•˜ê³  ì‹¤í–‰í•˜ê¸°

[Windows ëª…ë ¹ í”„ë¡¬í”„íŠ¸(cmd)ì—ì„œ ls, clear ëª…ë ¹ì–´ ì‚¬ìš©í•˜ëŠ” ë°©ë²•](https://somjang.tistory.com/entry/Windows-%EB%AA%85%EB%A0%B9-%ED%94%84%EB%A1%AC%ED%94%84%ED%8A%B8cmd%EC%97%90%EC%84%9C-ls-clear-%EB%AA%85%EB%A0%B9%EC%96%B4-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95)

    âš ï¸ IntelliJ ë¹Œë“œ ì¢…ë£Œ í›„ ì‹¤í–‰ âš ï¸

- ëª…ë ¹ í”„ë¡¬í”„íŠ¸ (CMD)
1. ë¹Œë“œí•˜ê¸°

```bash
# cmd ì—ì„œ ls ëª…ë ¹ì–´ ì‚¬ìš©
doskey ls = dir

# ì´ë™
cd C:\Users\alsrud\Downloads\hello-spring\hello-spring

# ëª©ë¡ ì¡°íšŒ
ls

# ë¹Œë“œ
gradlew.bat build
```

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fb3iOi1%2FbtstayWGO7x%2FeOgO2Zknbe1Xnt1aax6kd0%2Fimg.png)

â¡ï¸ Windows : gradlew.bat

â¡ï¸ Mac : gradlew

2. ë¹Œë“œ í›„ í´ë” ì—´ê¸°

```bash
cd build/libs
```

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FHE9kU%2Fbtstbb1d9l4%2FjVOEdkzppnXcAdGpkB1azk%2Fimg.png)

3. jar íŒŒì¼ ì‹¤í–‰

```bash
java -jar hello-spring-0.0.1-SNAPSHOT.jar
```

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FIltpq%2Fbtstlheql86%2FmXcLpFaTUhIeDM04iw7jvK%2Fimg.png)

4. ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FOlQf3%2FbtstlMZDZSD%2F7sz4LL2PIx1tMkuCtH1C30%2Fimg.png)

- ì˜ ì•ˆë  ë•Œ ?
```bash
gradlew.bat clean build
```
â¡ï¸ build í´ë” ì§€ì› ë‹¤ê°€ ë‹¤ì‹œ ìƒì„±

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ì •ì  ì»¨í…ì¸ 

- [ìŠ¤í”„ë§ ë¶€íŠ¸ ì •ì  ì»¨í…ì¸  ê¸°ëŠ¥](https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content)

1. src/resources/static ì— hello-static.html ìƒì„±

```html
<!DOCTYPE html>
<html>
<head>
    <title>static content</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
ì •ì  ì»¨í…ì¸  ì…ë‹ˆë‹¤.
</body>
</html>
```

2. ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbld4oU%2FbtstkpEPtQQ%2FPWUgk3hQx9eNfKxhha41k0%2Fimg.png)

- ë™ì‘ ë°©ì‹

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbk4jAr%2FbtstmuZJfTZ%2FILszpKhnSKkqkewu76vKz1%2Fimg.png)

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# MVCì™€ í…œí”Œë¦¿ ì—”ì§„

- MVC : Model, View, Controller

1. src/main/java/hello.hellospring/controller/HelloController ì— GetMapping ì¶”ê°€

```java
package hello.hellospring.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class HelloController {

    ...

    @GetMapping("hello-mvc")
    public String helloMvc(@RequestParam("name") String name, Model model) {
        model.addAttribute("name", name);
        return "hello-template";
    }
}
```

2. src/resources/templates ì— hello-template.html ì¶”ê°€

```html
<!DOCTYPE html>
<!-- thymeleaf ë¬¸ë²• ì‚¬ìš© ê°€ëŠ¥ -->
<html xmlns:th="http://www.thymeleaf.org">
<body>
<!-- key ê°’ì´ name ì¸ value ë°˜í™˜ (HelloController ì—ì„œ ì •ì˜) -->
<p th:text="'hello ' + ${name}">hello! empty</p>
</body>
</html>
```

3. ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸  
![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FumFZY%2Fbtstg5mj7my%2FQLw38G00ICehVSCTkx3agK%2Fimg.png)

- ë™ì‘ ë°©ì‹

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdpgmQv%2FbtstnxhB890%2FLDdSAAzskQnXOw9CEpHSHK%2Fimg.png)

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# API

### GetMapping("hello-string")

1. src/main/java/hello.hellospring/controller/HelloController ì— GetMapping ì¶”ê°€

```java
package hello.hellospring.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
public class HelloController {

    ...

    @GetMapping("hello-string")
    // ResponseBody : http body ë¶€ë¶„ì— ì§ì ‘ ë°ì´í„° ì…ë ¥
    @ResponseBody
    public String helloString(@RequestParam("name") String name) {
        return "hello " + name;
    }
}
```

2. ì›¹ ë¸Œë¼ìš°ì € í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbXGOzI%2FbtstlOc3Apq%2FIkYkQoQlzpxKPuKFk7voWk%2Fimg.png)

â¡ï¸ View ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

### GetMapping("hello-api")

3. src/main/java/hello.hellospring/controller/HelloController ì— GetMapping ì¶”ê°€

```java
package hello.hellospring.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
public class HelloController {

    ...

    @GetMapping("hello-api")
    @ResponseBody
    public Hello helloApi(@RequestParam("name") String name) {
        Hello hello = new Hello(); // ê°ì²´ ìƒì„±
        hello.setName(name);
        return hello;
        // ê¸°ë³¸ìœ¼ë¡œ JSON ë°˜í™˜
    }

    static class Hello {
        private String name;

        public String getName() {
            return name;
        }

        public void setName(String name) {
            this.name = name;
        }
    }
}
```

4. ì›¹ ë¸Œë¼ìš°ì € í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcmwJRS%2Fbtstg1qHjq1%2Ftu25CgLWuv2LDKP46dkPmK%2Fimg.png)

- ë™ì‘ ë°©ì‹

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fba345u%2FbtstnwXiFGq%2FKIJvAFO1IQFxyNF169RH91%2Fimg.png)

- @ResponseBody ì‚¬ìš©
    - HTTP ì˜ Body ì— ë¬¸ì ë‚´ìš©ì„ ì§ì ‘ ë°˜í™˜
    - viewResolver ëŒ€ì‹  HttpMessageConverter ë™ì‘
    - ê¸°ë³¸ ë¬¸ì ì²˜ë¦¬ : StringHttpMessageConverter
    - ê¸°ë³¸ ê°ì²´ ì²˜ë¦¬ : MappingJackson2HttpMessageConverter

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬

- ë°ì´í„° : íšŒì›ID, ì´ë¦„
- ê¸°ëŠ¥ : íšŒì› ë“±ë¡, ì¡°íšŒ
- ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•ŠìŒ (ê°€ìƒì˜ ì‹œë‚˜ë¦¬ì˜¤)

### ì¼ë°˜ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ êµ¬ì¡°

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FxZS2c%2FbtstkvdZenO%2FeBO6c69Dclf8K8vwtAJ1TK%2Fimg.png)

- ì»¨íŠ¸ë¡¤ëŸ¬ : ì›¹ MVC ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• 
- ì„œë¹„ìŠ¤ : í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
- ë¦¬í¬ì§€í† ë¦¬ : ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼, ë„ë©”ì¸ ê°ì²´ë¥¼ DB ì— ì €ì¥í•˜ê³  ê´€ë¦¬
- ë„ë©”ì¸ : ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´
    - ì˜ˆ) íšŒì›, ì£¼ë¬¸, ì¿ í° ë“±ë“± ì£¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³  ê´€ë¦¬ë¨

### í´ë˜ìŠ¤ ì˜ì¡´ê´€ê³„

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FXivay%2Fbtstyg7jjLA%2FwbnXeGPtZaaOlPJI2kgeg0%2Fimg.png)

â¡ï¸ ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•Šì•„ì„œ, ìš°ì„  ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„  

â¡ï¸ ë°ì´í„° ì €ì¥ì†ŒëŠ” RDB, NoSQL ë“±ë“± ë‹¤ì–‘í•œ ì €ì¥ì†Œë¥¼ ê³ ë¯¼ì¤‘ì¸ ìƒí™©ìœ¼ë¡œ ê°€ì •

â¡ï¸ ê°œë°œì„ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œ ì´ˆê¸° ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” êµ¬í˜„ì²´ë¡œ ê°€ë²¼ìš´ ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ ë°ì´í„° ì €ì¥ì†Œ ì‚¬ìš©

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# íšŒì› ë„ë©”ì¸ê³¼ ë¦¬í¬ì§€í† ë¦¬ ë§Œë“¤ê¸°

### íšŒì› ê°ì²´

1. src/main/java/hello.hellospring ì— domain package ì¶”ê°€
2. domain package ì— Member class ì¶”ê°€

```java
package hello.hellospring.domain;

public class Member {

    private Long id;
    private String name;

    // Alt + Insert -> Getter and Setter ìë™ìœ¼ë¡œ í•¨ìˆ˜ ìƒì„±
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

### íšŒì› ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤

1. src/main/java/hello.hellospring ì— repository package ìƒì„±
2. repository package ì— MemberRepository Interface ìƒì„±

```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;

import java.util.List;
import java.util.Optional;

public interface MemberRepository {
    Member save(Member member); // íšŒì› ì €ì¥
    Optional<Member> findById(Long id); // id ë¡œ íšŒì› ì°¾ê¸°
    Optional<Member> findByNames(String name); // name ìœ¼ë¡œ íšŒì› ì°¾ê¸°
    List<Member> findAll(); // ì§€ê¸ˆê¹Œì§€ ì €ì¥í•œ ëª¨ë“  íšŒì› ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
}
```

### íšŒì› ë¦¬í¬ì§€í† ë¦¬ ë©”ëª¨ë¦¬ êµ¬í˜„ì²´

1. repository package ì— MemoryMemberRepository class ìƒì„±
```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;

import java.util.*;

public class MemoryMemberRepository implements MemberRepository{
// ë™ì‹œì„± ë¬¸ì œê°€ ê³ ë ¤ë˜ì§€ ì•ŠìŒ : ì‹¤ë¬´ì—ì„œëŠ” ConcurrentHashMap, AtomicLong ì‚¬ìš© ê³ ë ¤

    private static Map<Long, Member> store = new HashMap<>();
    private static long sequence = 0L;

    @Override
    public Member save(Member member) {
        member.setId(++sequence); // store ì— ì €ì¥ ì „ id setting
        store.put(member.getId(), member);
        return member;
    }

    @Override
    public Optional<Member> findById(Long id) {
        // Optinal.ofNullable ì‚¬ìš© ì‹œ Null ê°’ì´ ë°˜í™˜ë˜ì–´ë„ ì‚¬ìš© ê°€ëŠ¥
        return Optional.ofNullable(store.get(id));
    }

    @Override
    public Optional<Member> findByNames(String name) {
        return store.values().stream()
                .filter(member -> member.getName().equals(name))
                .findAny();
    }

    @Override
    public List<Member> findAll() {
        return new ArrayList<>(store.values());
    }
}
```

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# íšŒì› ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±

    ğŸ’¡ ê°œë°œí•œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œ ìë°”ì˜ Main ë©”ì„œë“œë¥¼ í†µí•´ ì‹¤í–‰í•˜ê±°ë‚˜, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´ í•´ë‹¹ ê¸°ëŠ¥ ì‹¤í–‰í•œë‹¤. 
    ì´ëŸ¬í•œ ë°©ë²•ì€ ì¤€ë¹„í•˜ê³  ì‹¤í–‰í•˜ëŠ”ë° ì˜¤ë˜ ê±¸ë¦¬ê³ , ë°˜ë³µí•˜ê¸° ì–´ë ¤ìš°ë©°, ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ í•œ ë²ˆì— ì‹¤í–‰í•˜ê¸° ì–´ë µë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤. 
    ìë°”ëŠ” JUnit ì´ë¼ëŠ” í”„ë ˆì„ì›Œí¬ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.

### íšŒì› ë¦¬í¬ì§€í† ë¦¬ ë©”ëª¨ë¦¬ êµ¬í˜„ì²´ í…ŒìŠ¤íŠ¸

1. test/java/hello.hellospring ì— repository package ìƒì„±
2. repository package ì— MemoryMemberRepositoryTest class ìƒì„±

```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Test;

import java.util.List;

import static org.assertj.core.api.Assertions.*;

class MemoryMemberRepositoryTest {

    MemoryMemberRepository repository = new MemoryMemberRepository();

    // ìˆœì„œëŠ” ë³´ì¥ì´ ì•ˆë¨ -> ê° í…ŒìŠ¤íŠ¸ê°€ ëë‚  ë•Œë§ˆë‹¤ repository ë¹„ì›Œì£¼ê¸°
    @AfterEach
    public void afterEach() {
        repository.clearStore();
    }

    @Test
    public void save() {
        Member member = new Member();
        member.setName("spring");

        repository.save(member);

        Member result = repository.findById(member.getId()).get();
        assertThat(member).isEqualTo(result); // member ì´ë‘ result ë‘ ê°™ì€ì§€ ë¹„êµ
    }

    @Test
    public void findbyName() {
        Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1);

        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2);

        Member result = repository.findByNames("spring1").get();

        assertThat(result).isEqualTo(member1);
    }

    @Test
    public void findAll() {
        Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1);

        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2);

        List<Member> result = repository.findAll();

        assertThat(result.size()).isEqualTo(2);
    }
}
```

â¡ï¸ @AfterEach : í•œ ë²ˆì— ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ë©”ëª¨ë¦¬ DB ì— ì§ì „ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ë‚¨ì„ ìˆ˜ ìˆì–´ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•  ê°€ëŠ¥ì„±ì´ ìˆë‹¤. @AfterEach ë¥¼ ì‚¬ìš©í•˜ë©´ ê° í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œë  ë•Œë§ˆë‹¤ ì´ ê¸°ëŠ¥ì„ ì‹¤í–‰í•œë‹¤. ì—¬ê¸°ì„œëŠ” ë©”ëª¨ë¦¬ DB ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì‚­ì œí•œë‹¤.

â¡ï¸ í…ŒìŠ¤íŠ¸ëŠ” ê°ê° ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤. í…ŒìŠ¤íŠ¸ ìˆœì„œì— ì˜ì¡´ê´€ê³„ê°€ ìˆëŠ” ê²ƒì€ ì¢‹ì€ í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹ˆë‹¤.

- í…ŒìŠ¤íŠ¸ ê²°ê³¼
![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbL036i%2Fbtsts1wTZI8%2FzsotDpsLUHE1Q4zHF9A1P0%2Fimg.png)

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ

1. src/main/java/hello.hellospring ì— service package ìƒì„±
2. service package ì— MemberService ìƒì„±
```java
package hello.hellospring.service;

import hello.hellospring.domain.Member;
import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;

import java.util.List;
import java.util.Optional;

public class MemberService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();

    // íšŒì› ê°€ì…
    public Long join(Member member) {
        validateDuplicateMember(member); // ì¤‘ë³µ íšŒì› ê²€ì¦
        memberRepository.save(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member) {
        // ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µ íšŒì› X
        // Null ì¼ ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë©´ Optional ì‚¬ìš©
        memberRepository.findByNames(member.getName())
            .ifPresent(m -> {
                throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
            });
    }

    // ì „ì²´ íšŒì› ì¡°íšŒ
    public List<Member> findMembers() {
        return memberRepository.findAll();
    }
    
    public Optional<Member> findOne(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

    ğŸ’¡ Ctrl + Shift + T : í…ŒìŠ¤íŠ¸ ì‰½ê²Œ ë§Œë“¤ê¸° (ìœˆë„ìš°)

### MemberService ë³€ê²½

```java
...
public class MemberService {

    private final MemberRepository memberRepository;
    // ì™¸ë¶€ì—ì„œ ë„£ì–´ì£¼ê¸°
    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }
		...
}
```

### MemberServiceTest

```java
package hello.hellospring.service;

import hello.hellospring.domain.Member;
import hello.hellospring.repository.MemoryMemberRepository;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.*;
import static org.junit.jupiter.api.Assertions.*;

class MemberServiceTest {

    MemberService memberService;
    MemoryMemberRepository memberRepository;

    @BeforeEach
    public void beforeEach() {
        memberRepository = new MemoryMemberRepository();
        memberService = new MemberService(memberRepository);
    }
    
    @AfterEach
    public void afterEach() {
        memberRepository.clearStore();
    }

    @Test
    void íšŒì›ê°€ì…() {
        // given
        Member member = new Member();
        member.setName("hello");

        // when
        Long saveId = memberService.join(member);

        // then
        Member findMember = memberService.findOne(saveId).get();
        assertThat(member.getName()).isEqualTo(findMember.getName());
    }

    @Test
    void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸() {
        // given
        Member member1 = new Member();
        member1.setName("spring");

        Member member2 = new Member();
        member2.setName("spring");

        // when
        memberService.join(member1);
        IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));
        assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
/*        try {
              memberService.join(member2);
              fail("ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•©ë‹ˆë‹¤.");
          } catch (IllegalStateException e) {
              Assertions.assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
          }
*/    }

    @Test
    void findMembers() {
    }

    @Test
    void findOne() {
    }
}
```

- @BeforeEach
  - ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ í˜¸ì¶œ
  - í…ŒìŠ¤íŠ¸ ê°„ ì˜í–¥ì´ ì—†ë„ë¡ í•­ìƒ ìƒˆë¡œìš´ ê°ì²´ ìƒì„±
  - ìƒˆë¡œìš´ ì˜ì¡´ê´€ê³„ í˜•ì„±

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ê³¼ ìë™ ì˜ì¡´ê´€ê³„ ì„¤ì •

    ğŸ’¡ íšŒì› ì»¨íŠ¸ë¡¤ëŸ¬ê°€ íšŒì› ì„œë¹„ìŠ¤ì™€ íšŒì› ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì˜ì¡´ê´€ê³„ë¥¼ ì¤€ë¹„

- ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•˜ëŠ” 2ê°€ì§€ ë°©ë²•
    - ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ê³¼ ìë™ ì˜ì¡´ê´€ê³„ ì„¤ì •
    - ìë°” ì½”ë“œë¡œ ì§ì ‘ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡í•˜ê¸°

- ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ì›ë¦¬
    - @Component ì• ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡
    - @Controller ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡ëœ ì´ìœ ë„ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ë•Œë¬¸
    - @Component ë¥¼ í¬í•¨í•˜ëŠ” ë‹¤ìŒ ì• ë…¸í…Œì´ì…˜ë„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡
        - @Controller
        - @Service
        - @Repository

### MemberController

- src/main/java/hello.hellospring/controller ì— MemberController ìƒì„±

```java
package hello.hellospring.controller;

import hello.hellospring.service.MemberService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;

// Controller ë“±ë¡
@Controller
public class MemberController {

    private final MemberService memberService;

    // ìë™ ì—°ê²°
    @Autowired
    public MemberController(MemberService memberService) {
        this.memberService = memberService;
    }
}
```

â¡ï¸ ìƒì„±ìì— @Autowired ê°€ ìˆìœ¼ë©´ ìŠ¤í”„ë§ì´ ì—°ê´€ëœ ê°ì²´ë¥¼ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ì°¾ì•„ì„œ ë„£ì–´ì¤€ë‹¤. ì´ë ‡ê²Œ ê°ì²´ ì˜ì¡´ê´€ê³„ë¥¼ ì™¸ë¶€ì—ì„œ ë„£ì–´ì£¼ëŠ” ê²ƒì„ DI (Dependency Injection), ì˜ì¡´ì„± ì£¼ì…ì´ë¼ í•œë‹¤.

â¡ï¸ ì´ì „ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ê°œë°œìê°€ ì§ì ‘ ì£¼ì…í–ˆê³ , ì—¬ê¸°ì„œëŠ” @Autowired ì— ì˜í•´ ìŠ¤í”„ë§ì´ ì£¼ì…í•´ì¤€ë‹¤.

> ì°¸ê³  : helloController ëŠ” ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì´ê¸° ë•Œë¬¸ì— ìŠ¤í”„ë§ ë¹ˆì´ ìë™ ë“±ë¡ëœë‹¤. @Controller ê°€ ìˆìœ¼ë©´ ìë™ ë“±ë¡ëœë‹¤
>

### MemberService

```java
...

@Service
public class MemberService {

    @Autowired
    private final MemberRepository memberRepository;
    // ì™¸ë¶€ì—ì„œ ë„£ì–´ì£¼ê¸°
    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }
		...
}
```

> ì°¸ê³  : ìƒì„±ìì— @Autowired ë¥¼ ì‚¬ìš©í•˜ë©´ ê°ì²´ ìƒì„± ì‹œì ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ í•´ë‹¹ ìŠ¤í”„ë§ ë¹ˆì„ ì°¾ì•„ ì£¼ì…í•œë‹¤. ìƒì„±ìê°€ 1ê°œë§Œ ìˆìœ¼ë©´ @Autowired ëŠ” ìƒëµí•  ìˆ˜ ìˆë‹¤
>

### MemoryMemberRepository

```java
...

@Repository
public class MemoryMemberRepository implements MemberRepository{
// ë™ì‹œì„± ë¬¸ì œê°€ ê³ ë ¤ë˜ì§€ ì•ŠìŒ : ì‹¤ë¬´ì—ì„œëŠ” ConcurrentHashMap, AtomicLong ì‚¬ìš© ê³ ë ¤

    private static Map<Long, Member> store = new HashMap<>();
    private static long sequence = 0L;

    ...
}
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/41d467f2-5e7c-44b9-bd8f-32790fc9fc0b/Untitled.png)

### MemoryMemberRepository
```java
...

@Repository
public class MemoryMemberRepository implements MemberRepository{
// ë™ì‹œì„± ë¬¸ì œê°€ ê³ ë ¤ë˜ì§€ ì•ŠìŒ : ì‹¤ë¬´ì—ì„œëŠ” ConcurrentHashMap, AtomicLong ì‚¬ìš© ê³ ë ¤

    private static Map<Long, Member> store = new HashMap<>();
    private static long sequence = 0L;

    ...
}
```

- ì‘ë™ ë°©ì‹
![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcbDWi3%2FbtstvROyJpF%2Fe6OGA0Dzj9F0S4OQ1zswTk%2Fimg.png)

â¡ï¸ memberService ì™€ memberRepository ê°€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì—ˆë‹¤.

> ì°¸ê³  : ìŠ¤í”„ë§ì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•  ë•Œ, ê¸°ë³¸ìœ¼ë¡œ ì‹±ê¸€í†¤ìœ¼ë¡œ ë“±ë¡í•œë‹¤. (ìœ ì¼í•˜ê²Œ í•˜ë‚˜ë§Œ ë“±ë¡í•´ì„œ ê³µìœ ) ë”°ë¼ì„œ ê°™ì€ ìŠ¤í”„ë§ ë¹ˆì´ë©´ ëª¨ë‘ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì´ë‹¤. ì„¤ì •ìœ¼ë¡œ ì‹±ê¸€í†¤ì´ ì•„ë‹ˆê²Œ ì„¤ì •í•  ìˆ˜ ìˆì§€ë§Œ, íŠ¹ë³„í•œ ê²½ìš°ë¥¼ ì œì™¸í•˜ë©´ ëŒ€ë¶€ë¶„ ì‹±ê¸€í†¤ì„ ì‚¬ìš©í•œë‹¤
>

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ìë°” ì½”ë“œë¡œ ì§ì ‘ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡í•˜ê¸°

    ğŸ’¡ íšŒì› ì„œë¹„ìŠ¤ì™€ íšŒì› ë¦¬í¬ì§€í† ë¦¬ì˜ @Service, @Repository, @Autowired ì• ë…¸í…Œì´ì…˜ì„ ì œê±°í•˜ê³  ì§„í–‰

- src/main/java/hello.hellospring ì— SpringConfig class ìƒì„±

```java
package hello.hellospring;

import hello.hellospring.service.MemberService;
import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SpringConfig {

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository());
    }

    @Bean
    public MemberRepository memberRepository() {
        return new MemoryMemberRepository();
    }
}
```

â¡ï¸ ì´ ê°•ì˜ì—ì„œëŠ” í–¥í›„ ë©”ëª¨ë¦¬ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ë‹¤ë¥¸ ë¦¬í¬ì§€í† ë¦¬ë¡œ ë³€ê²½í•  ì˜ˆì •ì´ë¯€ë¡œ, ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ë°©ì‹ ëŒ€ì‹  ìë°” ì½”ë“œë¡œ ìŠ¤í”„ë§ ë¹ˆì„ ì„¤ì • : ê¸°ì¡´ ì½”ë“œ ë³€ê²½ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥
> ì°¸ê³  : XML ë¡œ ì„¤ì •í•˜ëŠ” ë°©ì‹ë„ ìˆì§€ë§Œ, ìµœê·¼ì—ëŠ” ì˜ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìƒëµí•œë‹¤
>

> ì°¸ê³  : DI ì—ëŠ” í•„ë“œ ì£¼ì…, setter ì£¼ì…, ìƒì„±ì ì£¼ì… 3ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤. ì˜ì¡´ê´€ê³„ê°€ ì‹¤í–‰ ì¤‘ì— ë™ì ìœ¼ë¡œ ë³€í•˜ëŠ” ê²½ìš°ëŠ” ê±°ì˜ ì—†ìœ¼ë¯€ë¡œ ìƒì„±ì ì£¼ì…ì„ ê¶Œì¥í•œë‹¤
>

> ì°¸ê³  : ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ ì •í˜•í™”ëœ ì»¨íŠ¸ë¡¤ëŸ¬, ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬ ê°™ì€ ì½”ë“œëŠ” ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ ì‚¬ìš©í•œë‹¤. ì´ë•Œ, ì •í˜•í™”ë˜ì§€ ì•Šê±°ë‚˜, ìƒí™©ì— ë”°ë¼ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•´ì•¼ í•œë‹¤ë©´ ì„¤ì •ì„ í†µí•´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤
>

> ì£¼ì˜ : @Autowired ë¥¼ í†µí•œ DI ëŠ” helloController, memberService ë“±ê³¼ ê°™ì´ ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” ê°ì²´ì—ì„œë§Œ ë™ì‘í•œë‹¤. ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šê³  ë‚´ê°€ ì§ì ‘ ìƒì„±í•œ ê°ì²´ì—ì„œëŠ” ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤
>

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# íšŒì› ì›¹ ê¸°ëŠ¥ - í™ˆ í™”ë©´ ì¶”ê°€

### í™ˆ ì»¨íŠ¸ë¡¤ëŸ¬ ì¶”ê°€

- src/main/java/hello.hellospring/controller ì— HomeController class ìƒì„±

```java
package hello.hellospring.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HomeController {

    @GetMapping("/")
    public String home() {
        return "home";
    }
}
```

### íšŒì› ê´€ë¦¬ìš© í™ˆ

- src/main/resources/templates ì— home.html ìƒì„±

```html
<!DOCTYPE html>
<!-- thymeleaf ë¬¸ë²• ì‚¬ìš© ê°€ëŠ¥ -->
<html xmlns:th="http://www.thymeleaf.org">
<body>

<div class="container">
    <div>
        <h1>Hello Spring</h1>
        <p>íšŒì› ê¸°ëŠ¥</p>
        <p>
            <a href="/members/new">íšŒì› ê°€ì…</a>
            <a href="/members">íšŒì› ëª©ë¡</a>
        </p>
    </div>
</div>

</body>
</html>
```

> ì°¸ê³  : ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì •ì  íŒŒì¼ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ë‹¤
>

- ì›¹ ë¸Œë¼ìš°ì € í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fcm6PF6%2FbtstvRgL4aA%2FK1k48UIc2BUX9Xl8YLkWI1%2Fimg.png)

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# íšŒì› ì›¹ ê¸°ëŠ¥ - ë“±ë¡

### íšŒì› ë“±ë¡ í¼ ê°œë°œ

#### âœ… íšŒì› ë“±ë¡ í¼ ì»¨íŠ¸ë¡¤ëŸ¬

- src/main/java/hello.hellospring/controller ì— MemberController class ìƒì„±

```java
package hello.hellospring.controller;

import hello.hellospring.domain.Member;
import hello.hellospring.service.MemberService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;

// Controller ë“±ë¡
@Controller
public class MemberController {

    private final MemberService memberService;

    // ìë™ ì—°ê²°
    @Autowired
    public MemberController(MemberService memberService) {
        this.memberService = memberService;
    }

    @GetMapping("/members/new")
    public String createForm() {
        return "members/createMemberForm";
    }
}
```

#### âœ… íšŒì› ë“±ë¡ í¼ HTML

1. src/main/resources/templates ì— members directory ìƒì„±
2. members directory ì— createMemberForm.html ìƒì„±

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ê°€ì…</title>
</head>
<body>

<div class="container">
    <form action="/members/new" method="post">
        <div class="form-group">
            <label for="name">ì´ë¦„</label>
            <input type="text" id="name" name="name" placeholder="ì´ë¦„ì„
ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <button type="submit">ë“±ë¡</button>
    </form>
</div>

</body>
</html>
```

### íšŒì› ë“±ë¡ ì»¨íŠ¸ë¡¤ëŸ¬

#### âœ… ì›¹ ë“±ë¡ í™”ë©´ì—ì„œ ë°ì´í„°ë¥¼ ì „ë‹¬ ë°›ì„ í¼ ê°ì²´

- src/main/java/hello.hellospring/controller ì— MemberForm class ìƒì„±

```java
package hello.hellospring.controller;

public class MemberForm {
    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

#### âœ… íšŒì› ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ íšŒì›ì„ ì‹¤ì œ ë“±ë¡í•˜ëŠ” ê¸°ëŠ¥

- MemberController ì— ì½”ë“œ ì¶”ê°€
```java
...

// Controller ë“±ë¡
@Controller
public class MemberController {

    ...

    @PostMapping("/members/new")
    public String create(MemberForm form) {
        Member member = new Member();
        member.setName(form.getName());

        memberService.join(member);

        return "redirect:/";
    }
}
```

- ì›¹ ë¸Œë¼ìš°ì € í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FqYVDZ%2FbtstwFUCYsN%2FXMje0ykQrxTdnKeQdtHDo1%2Fimg.png)

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# íšŒì› ì›¹ ê¸°ëŠ¥ - ì¡°íšŒ

### íšŒì› ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€

- MemberController ì— code ì¶”ê°€

```java
...

@Controller
public class MemberController {

    ...

    @GetMapping("/members")
    public String list(Model model) {
        List<Member> members = memberService.findMembers();
        model.addAttribute("members", members);
        return "members/memberList";
    }
}
```

### íšŒì› ë¦¬ìŠ¤íŠ¸ HTML ìƒì„±

- src/resources/templates/members ì— memberList.html ìƒì„±
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ì¡°íšŒ</title>
</head>
<body>

<div class="container">
  <div>
    <table>
      <thead>
      <tr>
        <th>#</th>
        <th>ì´ë¦„</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="member : ${members}">
        <td th:text="${member.id}"></td>
        <td th:text="${member.name}"></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

</body>
</html>
```

- ì›¹ ë¸Œë¼ìš°ì € í™•ì¸

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F07rMK%2Fbtstq5Ntcqa%2FtzGM9QUQpSsEELCzxuw7C1%2Fimg.png)

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜

- ê°œë°œì´ë‚˜ í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ê°€ë³ê³  í¸ë¦¬í•œ DB, ì›¹ í™”ë©´ ì œê³µ

### 1. H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜
#### âœ… ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìš´ë¡œë“œ

- [Archive Downloads (h2database.com)](https://www.h2database.com/html/download-archive.html)
    - 1.4.200

#### âœ… ë‹¤ìš´ë°›ì€ bin í´ë”ì—ì„œ h2.bat ì‹¤í–‰

```bash
cd C:\Users\alsrud\Downloads\H2
cd bin
h2.bat
```

#### âœ… ì‹œì‘ ì„¤ì •

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FeCCUBH%2FbtstyiLZJUh%2FMAIssgwkFKKIkVOLfg5d5k%2Fimg.png)

- ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ ìƒì„± ë°©ë²•
  - jdbc:h2:~/test (ìµœì´ˆ í•œ ë²ˆ)
  - í™ˆì— ìƒì„±ëœ ~/test.mv.db íŒŒì¼ í™•ì¸ â†’ ì§€ì›Œì£¼ê¸° (rm)
  - ì´í›„ë¶€í„°ëŠ” jdbc:h2:tcp://localhost/~/test ë¡œ ì ‘ì†

- ì ‘ì† í™”ë©´

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FkZZCB%2FbtstxkctJyP%2Fx8dkKxsRmcA8XTUDmWyuKK%2Fimg.png)

### 2. í…Œì´ë¸” ìƒì„±
#### âœ… SQL ë¬¸ ì‘ì„± (í…Œì´ë¸” ìƒì„±)

```sql
drop table if exists member CASCADE;
create table member
(
id bigint generated by default as identity,
name varchar(255),
primary key (id)
);
```

- ì‹¤í–‰ í™”ë©´

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FblGWLe%2FbtstzlaDD1S%2FQfeC0MZKtgEetaLCp5Dyc0%2Fimg.png)

â†’ MEMBER table ìƒì„± ì™„ë£Œ

#### âœ… SQL ë¬¸ ì‘ì„± (ê°’ ëŒ€ì…)

```sql
insert into member(name) values('spring');
insert into member(name) values('spring2');
```

- ì‹¤í–‰ í™”ë©´

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FctDcuJ%2FbtstMkIsbe2%2FZLTWTGzllGcDYAsukqXehK%2Fimg.png)

### 3. Intellij ì— ddl.sql íŒŒì¼ ì¶”ê°€
![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbue96G%2FbtstLNRElIQ%2FSPvvOI6ScoPa3tRf3YpwiK%2Fimg.png)

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ìˆœìˆ˜ Jdbc

- ê³ ëŒ€ì˜ ë°©ì‹ì´ë¼ê³  í•œë‹¤ ğŸ˜‘

### í™˜ê²½ ì„¤ì •

#### âœ… build.gradle íŒŒì¼ì— jdbc, h2 ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€

```json
implementation 'org.springframework.boot:spring-boot-starter-jdbc'
runtimeOnly 'com.h2database:h2'
```

- ì¶”ê°€ í™”ë©´

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FQxTjW%2FbtstMAy3e16%2FKPZNgUsNbPxVWPhBbRpnfk%2Fimg.png)

#### âœ… ìŠ¤í”„ë§ ë¶€íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì • ì¶”ê°€ (resources/application.properties)

```json
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
```

- ì¶”ê°€ í™”ë©´

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FkzfXb%2FbtstG5ftqZL%2FkjQXMxK4aqfNmhmJcD95B0%2Fimg.png)

> ì£¼ì˜ : ìŠ¤í”„ë§ë¶€í„° 2.4 ë¶€í„°ëŠ” spring.datasource.username=sa ë¥¼ ê¼­ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Wrong user name or password ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. ì°¸ê³ ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë§ˆì§€ë§‰ì— ê³µë°±ì´ ë“¤ì–´ê°€ë©´ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. spring.datasource.username=sa ê³µë°± ì£¼ì˜, ê³µë°±ì€ ëª¨ë‘ ì œê±°í•´ì•¼ í•œë‹¤.
>

> ì°¸ê³  : IntelliJ ì»¤ë®¤ë‹ˆí‹°(ë¬´ë£Œ) ë²„ì „ì˜ ê²½ìš° [application.properties](http://application.properties) íŒŒì¼ì˜ ì™¼ìª½ì´ ë‹¤ìŒ ê·¸ë¦¼ê³¼ ê°™ì´ íšŒìƒ‰ìœ¼ë¡œ ë‚˜ì˜¨ë‹¤. ì—”í„°í”„ë¼ì´ì¦ˆ(ìœ ë£Œ) ë²„ì „ì—ì„œ ì œê³µí•˜ëŠ” ìŠ¤í”„ë§ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì—°ê²°í•´ì£¼ëŠ” í¸ì˜ ê¸°ëŠ¥ì´ ë¹ ì§„ ê²ƒì¸ë°, ì‹¤ì œ ë™ì‘í•˜ëŠ” ë°ëŠ” ì•„ë¬´ëŸ° ë¬¸ì œê°€ ì—†ë‹¤.
>

## Jdbc ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„

> ì£¼ì˜ : ìŠ¤í”„ë§ ë¶€íŠ¸ 2.4 ë¶€í„°ëŠ” spring.datasource.username=sa ë¥¼ ê¼­ ì¶”ê°€í•´ì•¼ í•œë‹¤. ì¶”ê°€í•˜ì§€ ì•Šì„ ì‹œ Wrong user name or password ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. ë§ˆì§€ë§‰ì— ê³µë°±ì´ ë“¤ì–´ê°€ë„ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.>
> 

### Jdbc íšŒì› ë¦¬í¬ì§€í† ë¦¬

> ì£¼ì˜ : ì´ë ‡ê²Œ JDBC API ë¡œ ì§ì ‘ ì½”ë”©í•˜ëŠ” ê²ƒì€ 20ë…„ ì „ ì´ì•¼ê¸°ë¡œ, ì°¸ê³ ë§Œ í•˜ê³  ë„˜ì–´ê°€ê¸°
>

#### âœ… Jdbc íšŒì› ë¦¬í¬ì§€í† ë¦¬ ìƒì„±

- src/main/java/hello.hellospring/repository ì— JdbcMemberRepository class ìƒì„±

```java
package hello.hellospring.repository;
import hello.hellospring.domain.Member;
import org.springframework.jdbc.datasource.DataSourceUtils;
import javax.sql.DataSource;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
public class JdbcMemberRepository implements MemberRepository {
    private final DataSource dataSource;
    public JdbcMemberRepository(DataSource dataSource) {
        this.dataSource = dataSource;
    }
    @Override
    public Member save(Member member) {
        String sql = "insert into member(name) values(?)";
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql,
                    Statement.RETURN_GENERATED_KEYS);
            pstmt.setString(1, member.getName());
            pstmt.executeUpdate();
            rs = pstmt.getGeneratedKeys();
            if (rs.next()) {
                member.setId(rs.getLong(1));
            } else {
                throw new SQLException("id ì¡°íšŒ ì‹¤íŒ¨");
            }
            return member;
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }
    @Override
    public Optional<Member> findById(Long id) {
        String sql = "select * from member where id = ?";
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql);
            pstmt.setLong(1, id);
            rs = pstmt.executeQuery();
            if(rs.next()) {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));
                return Optional.of(member);
            } else {
                return Optional.empty();
            }
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }
    @Override
    public List<Member> findAll() {
        String sql = "select * from member";
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql);
            rs = pstmt.executeQuery();
            List<Member> members = new ArrayList<>();
            while(rs.next()) {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));
                members.add(member);
            }
            return members;
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }
    @Override
    public Optional<Member> findByNames(String name) {
        String sql = "select * from member where name = ?";
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql);
            pstmt.setString(1, name);
            rs = pstmt.executeQuery();
            if(rs.next()) {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));
                return Optional.of(member);
            }
            return Optional.empty();
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }
    private Connection getConnection() {
        return DataSourceUtils.getConnection(dataSource);
    }
    private void close(Connection conn, PreparedStatement pstmt, ResultSet rs)
    {
        try {
            if (rs != null) {
                rs.close();
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        try {
            if (pstmt != null) {
                pstmt.close();
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        try {
            if (conn != null) {
                close(conn);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    private void close(Connection conn) throws SQLException {
        DataSourceUtils.releaseConnection(conn, dataSource);
    }
}
```

    ğŸ’¡ DataSourceUtils import error â†’ gradle refresh í•˜ê¸°

#### âœ… ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½

- src/main/java/hello.hellospring/service/SpringConfig

```java
package hello.hellospring;

import hello.hellospring.repository.JdbcMemberRepository;
import hello.hellospring.service.MemberService;
import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
public class SpringConfig {

    private DataSource dataSource;

    @Autowired
    public SpringConfig(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository());
    }

    @Bean
    public MemberRepository memberRepository() {
        //return new MemoryMemberRepository();
        return new JdbcMemberRepository(dataSource);
    }
}
```

â¡ï¸ MemoryMemberRepository ëŒ€ì‹  JdbcMemberRepository

- ìŠ¤í”„ë§ ì„¤ì • ì´ë¯¸ì§€

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FAtXYc%2FbtstRs1pVTB%2FrKa8Mjdh2WCu4GRGLXbGB1%2Fimg.png)

â†’ ê°œë°© - íì‡„ ì›ì¹™ ( OCP, Open - Closed Principle ) : í™•ì¥ì—ëŠ” ì—´ë ¤ ìˆê³ , ìˆ˜ì •/ë³€ê²½ì—ëŠ” ë‹«í˜€ ìˆë‹¤

â†’ ìŠ¤í”„ë§ì˜ DI ( Dependencies Injection ) ì„ ì‚¬ìš©í•˜ë©´ ê¸°ì¡´ ì½”ë“œë¥¼ ì†ëŒ€ì§€ ì•Šê³ , ì„¤ì •ë§Œìœ¼ë¡œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤

â†’ ë°ì´í„°ë¥¼ DB ì— ì €ì¥í•˜ë¯€ë¡œ ìŠ¤í”„ë§ ì„œë²„ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ë„ ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ì €ì¥ëœë‹¤

- ì‹¤í–‰ í™”ë©´

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FtgJMx%2FbtstRIXiY9z%2F1aixEmlqOiAYeHkWJQGUP0%2Fimg.png)

â†’ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í–ˆë˜ ë°ì´í„°ê°€ ì˜ ë“¤ì–´ì™€ ìˆë‹¤

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ DB ê¹Œì§€ ì—°ê²°í•œ í†µí•© í…ŒìŠ¤íŠ¸ ì§„í–‰í•˜ê¸°

### íšŒì› ì„œë¹„ìŠ¤ ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸

#### âœ… test/java/hello.hellospring/service ì— MemberServiceIntegrationTest ìƒì„±

```java
package hello.hellospring.service;

import hello.hellospring.domain.Member;
import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.transaction.annotation.Transactional;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertThrows;

@SpringBootTest
@Transactional
class MemberServiceIntegrationTest {

    @Autowired MemberService memberService;
    @Autowired MemberRepository memberRepository;

    @Test
    void íšŒì›ê°€ì…() {
        // given
        Member member = new Member();
        member.setName("hello");

        // when
        Long saveId = memberService.join(member);

        // then
        Member findMember = memberService.findOne(saveId).get();
        assertThat(member.getName()).isEqualTo(findMember.getName());
    }

    @Test
    void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸() {
        // given
        Member member1 = new Member();
        member1.setName("spring");

        Member member2 = new Member();
        member2.setName("spring");

        // when
        memberService.join(member1);
        IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));
        assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    }

}
```

#### âœ… í…ŒìŠ¤íŠ¸ í•˜ê¸° (@Transactional ì£¼ì„ ì²˜ë¦¬í•œ ìƒíƒœ)

1. MEMBER í…Œì´ë¸” ë°ì´í„° ì‚­ì œí•˜ê¸°

```sql
delete from member
```

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbwu2bM%2FbtstRLnbkZ0%2FWnSCxTBzAsjHDOTGhlTEVK%2Fimg.png)

2. IntelliJ ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ê¸°

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FRdf7x%2FbtstNyWdvNn%2FkLc75jokJ3feoHbxsWbbN1%2Fimg.png)

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FHujWT%2FbtstTblpzYb%2FYEtsrcxpzsVnKBIc4TtTAk%2Fimg.png)

- @SpringBootTest : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ í…ŒìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ì‹¤í–‰
- @Transactional : í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „ì— íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ í•­ìƒ ë¡¤ë°± (DBì— ë°ì´í„°ê°€ ë‚¨ì§€ ì•Šì•„ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ)

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ìŠ¤í”„ë§ JdbcTemplate

- ìˆœìˆ˜ Jdbc ì™€ ë™ì¼í•œ í™˜ê²½ì„¤ì •
- ìŠ¤í”„ë§ JdbcTemplate & MyBatis ë¼ì´ë¸ŒëŸ¬ë¦¬ â¡ï¸ JDBC API ì—ì„œ ë³¸ ë°˜ë³µ ì½”ë“œ ëŒ€ë¶€ë¶„ ì œê±°, ê·¸ëŸ¬ë‚˜ SQL ì€ ì§ì ‘ ì‘ì„±í•´ì•¼ í•¨

### ìŠ¤í”„ë§ JdbcTemplate íšŒì› ë¦¬í¬ì§€í† ë¦¬ ì‘ì„±
#### âœ… src/main/java/hello.hellospring/repository ì— JdbcTemplateMemberRepository ìƒì„±

```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.simple.SimpleJdbcInsert;

import javax.sql.DataSource;
import java.util.*;

public class JdbcTemplateMemberRepository implements MemberRepository {

    private final JdbcTemplate jdbcTemplate;

    @Autowired // ìƒì„±ìê°€ í•˜ë‚˜ë§Œ ìˆìœ¼ë©´ Autowired ìƒëµ ê°€ëŠ¥
    public JdbcTemplateMemberRepository(DataSource dataSource) {
        jdbcTemplate = new JdbcTemplate(dataSource);
    }

    @Override
    public Member save(Member member) {
        // SimpleJdbcInsert : sql insert ë¬¸ì„ ì“°ì§€ ì•Šê³ ë„ insert ê°€ëŠ¥
        SimpleJdbcInsert jdbcInsert = new SimpleJdbcInsert(jdbcTemplate);
        jdbcInsert.withTableName("member").usingColumns("id");

        Map<String, Object> parameters = new HashMap<>();
        parameters.put("name", member.getName());

        Number key = jdbcInsert.executeAndReturnKey(new MapSqlParameterSource(parameters));
        member.setId(key.longValue());
        return member;
    }

    @Override
    public Optional<Member> findById(Long id) {
        List<Member> result = jdbcTemplate.query("select * from member where id = ?", memberRowMapper(), id);
        return result.stream().findAny();
    }

    @Override
    public Optional<Member> findByNames(String name) {
        List<Member> result = jdbcTemplate.query("select * from member where name = ?", memberRowMapper(), name);
        return result.stream().findAny();
    }

    @Override
    public List<Member> findAll() {
        return jdbcTemplate.query("select * from member", memberRowMapper());
    }

    private RowMapper<Member> memberRowMapper() {
        return (rs, rowNum) -> {
            Member member = new Member();
            member.setId(rs.getLong("id"));
            member.setName(rs.getString("name"));
            return member;
        };
    }
}
```

### SpringConfig ì„¤ì • ë³€ê²½

#### âœ… jdbcTemplate ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½

â†’ ê·¼ë° ì›ë˜ ì„¤ì •ì´ë‘ ê°™ìŒ : return new JdbcTemplateMemberRepositoy(dataSource); ì¶”ê°€í•´ì£¼ëŠ” ê²ƒ

```java
...

@Configuration
public class SpringConfig {

    ...

    @Bean
    public MemberRepository memberRepository() {
        //return new MemoryMemberRepository();
        return new JdbcMemberRepository(dataSource);
    }
}
```

#### âœ… í…ŒìŠ¤íŠ¸ í•˜ê¸°

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbqx9tA%2FbtsuelnbIpJ%2FpNy6uR7kh5xkk8NBY1tqfK%2Fimg.png)

â†’ ì„±ê³µ

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# JPA

    ğŸ’¡í˜„ì¬ í•´ê²°ë˜ì§€ ì•Šì€ ê²ƒğŸ’¡ : SQL ì€ ê°œë°œìê°€ ì§ì ‘ ì‘ì„± â¡ï¸ JPA ì‚¬ìš© ì‹œ í•´ê²° ê°€ëŠ¥

    âœ… JPA ëŠ” ê¸°ì¡´ì˜ ë°˜ë³µ ì½”ë“œ & ê¸°ë³¸ì ì¸ SQL ì²˜ë¦¬, ì‹¤í–‰
    âœ… JPA ì‚¬ìš© ì‹œ SQL ê³¼ ë°ì´í„° ì¤‘ì‹¬ì˜ ì„¤ê³„ì—ì„œ ê°ì²´ ì¤‘ì‹¬ì˜ ì„¤ê³„ë¡œ ì „í™˜ ê°€ëŠ¥
    âœ… JPA ì‚¬ìš© ì‹œ ê°œë°œ ìƒì‚°ì„± í–¥ìƒ

### JPA, H2 ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€

- build.gradle íŒŒì¼ ìˆ˜ì •í•˜ê¸° â¡ï¸ ìˆ˜ì • í›„ refresh í•„ìˆ˜ !

```java
...

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	//implementation 'org.springframework.boot:spring-boot-starter-jdbc'
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
	runtimeOnly 'com.h2database:h2'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

...
```

â†’ spring-boot-starter-data-jpa ê°€ jdbc ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í¬í•¨í•˜ê³  ìˆê¸° ë•Œë¬¸ì— jdbc ëŠ” ì œê±° ê°€ëŠ¥

### ìŠ¤í”„ë§ ë¶€íŠ¸ì— JPA ì„¤ì • ì¶”ê°€

- resources/application.properties íŒŒì¼ ìˆ˜ì •

```java
...
spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=none
```

> ì£¼ì˜ : ìŠ¤í”„ë§ë¶€íŠ¸ 2.4 ë¶€í„°ëŠ” spring.datasource.username=sa ë¥¼ ê¼­ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
>

- show-sql : JPA ê°€ ìƒì„±í•˜ëŠ” SQL ì¶œë ¥
- ddl-auto : JPA ê°€ ì œê³µí•˜ëŠ” ìë™ í…Œì´ë¸” ìƒì„± ê¸°ëŠ¥
  - none : ê¸°ëŠ¥ ì œê±°
  - create : ì—”í‹°í‹° ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í…Œì´ë¸” ìƒì„±

### JPA ì—”í‹°í‹° ë§¤í•‘

- src\main\java\hello\hellospring\domain\Member ì„¤ì • ë³€ê²½

```java
package hello.hellospring.domain;

import jakarta.persistence.*;

@Entity // JPA ê°€ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°ë¼ëŠ” ëœ»
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY) // DB ê°€ ì•Œì•„ì„œ ID ìƒì„±
    private Long id;
    
    @Column(name = "username") // DB ì— ìˆëŠ” column ëª…ì´ username ì´ ë¨
    private String name;

    ...
}
```

### JPA íšŒì› ë¦¬í¬ì§€í† ë¦¬ ìƒì„±

- src/main/java/hello.hellospring/repository ì— JpaMemberRepository ìƒì„±

```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;
import jakarta.persistence.EntityManager;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Optional;

public class JpaMemberRepository implements MemberRepository{

    private final EntityManager em;

    public JpaMemberRepository(EntityManager em) {
        this.em = em;
    }

    @Override
    public Member save(Member member) {
        em.persist(member);
        return member;
    }

    @Override
    public Optional<Member> findById(Long id) {
        Member member = em.find(Member.class, id);
        return Optional.ofNullable(member);
    }

    @Override
    public Optional<Member> findByNames(String name) {
        List<Member> result = em.createQuery("select m from Member m where m.name = :name", Member.class)
                .setParameter("name", name)
                .getResultList();
        return result.stream().findAny();
    }

    @Override
    public List<Member> findAll() {
        return em.createQuery("select m from Member m", Member.class)
                .getResultList();
    }
}
```

### ì„œë¹„ìŠ¤ ê³„ì¸µì— íŠ¸ëœì­ì…˜ ì¶”ê°€

- src/main/java/hello.hellospring/service ì˜ MemberService íŒŒì¼ ìˆ˜ì •

```java
...

@Transactional
public class MemberService {

    ...
}
```

â†’ JPA ë¥¼ í†µí•œ ëª¨ë“  ë°ì´í„° ë³€ê²½ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì‹¤í–‰í•´ì•¼ í•¨

### ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½

- SpringConfig íŒŒì¼ ìˆ˜ì •

```java
...

@Configuration
public class SpringConfig {

    private EntityManager em;

    @Autowired
    public SpringConfig(EntityManager em) {
        this.em = em;
    }

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository());
    }

    @Bean
    public MemberRepository memberRepository() {
        //return new MemoryMemberRepository();
        //return new JdbcMemberRepository(dataSource);
        return new JpaMemberRepository(em);
    }
}
```

- í…ŒìŠ¤íŠ¸ í•˜ê¸°

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbdmlnW%2FbtsugTwTpNE%2FAAHFTkUNKi676AkRzA2gRK%2Fimg.png)

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# ìŠ¤í”„ë§ ë°ì´í„° JPA

    ğŸ’¡ ìŠ¤í”„ë§ ë°ì´í„° JPA ğŸ’¡
    â¡ï¸ ë¦¬í¬ì§€í† ë¦¬ì— êµ¬í˜„ í´ë˜ìŠ¤ ì—†ì´ ì¸í„°í˜ì´ìŠ¤ ë§Œìœ¼ë¡œ ê°œë°œ ì™„ë£Œ ê°€ëŠ¥
    â¡ï¸ ê¸°ë³¸ CRUD ê¸°ëŠ¥ ì œê³µ

    âš ï¸ì£¼ì˜âš ï¸
    ìŠ¤í”„ë§ ë°ì´í„° JPA ëŠ” JPA ë¥¼ í¸ë¦¬í•˜ê¸° ì‚¬ìš©í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ê¸°ìˆ ì´ë¯€ë¡œ JPA ë¥¼ ë¨¼ì € í•™ìŠµí•´ì•¼ í•¨

- ì•ì˜ JPA ì„¤ì •ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©

### ìŠ¤í”„ë§ ë°ì´í„° JPA íšŒì› ë¦¬í¬ì§€í† ë¦¬

- src/main/java/hello.hellospring/repository ì— SpringDataJpaMemberRepository ì¸í„°í˜ì´ìŠ¤ ìƒì„±

```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

// ì¸í„°í˜ì´ìŠ¤ëŠ” ë‹¤ì¤‘ ìƒì† ê°€ëŠ¥
public interface SpringDataJpaMemberRepository extends JpaRepository<Member, Long>, MemberRepository {

    // select m from Member m where m.name = ?
    @Override
    Optional<Member> findByNames(String name);
}
```

### ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½

- SpringConfig ì½”ë“œ ìˆ˜ì •

```java
package hello.hellospring;

import hello.hellospring.repository.JpaMemberRepository;
import hello.hellospring.service.MemberService;
import hello.hellospring.repository.MemberRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SpringConfig {

    // ë§Œë“¤ì–´ ë†“ì€ SpringDataJpaRepository êµ¬í˜„ì²´ê°€ ì„¸íŒ…ëœë‹¤ -> ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡
    private final MemberRepository memberRepository;

    @Autowired
    public SpringConfig(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository);
    }

}
```

- í…ŒìŠ¤íŠ¸ í•˜ê¸°

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fb6Dbpe%2Fbtsuh4MH3uu%2FXi1oP2I9YWkCp3e3ktAl4K%2Fimg.png)

â†’ ì„±ê³µ

### ìŠ¤í”„ë§ ë°ì´í„° JPA ì œê³µ í´ë˜ìŠ¤

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FDAckP%2FbtsuAt53Skc%2F5hl5kY2TztrwubqiXESVV1%2Fimg.png)

â†’ í´ë˜ìŠ¤ êµ¬í˜„ ì—†ì´ë„ ê°œë°œ ê°€ëŠ¥

### ìŠ¤í”„ë§ ë°ì´í„° JPA ì œê³µ ê¸°ëŠ¥

1. ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ê¸°ë³¸ CRUD
2. findByName(), findByEmail() ì²˜ëŸ¼ ë©”ì„œë“œ ì´ë¦„ ë§Œìœ¼ë¡œ ì¡°íšŒ ê°€ëŠ¥
3. ìë™ í˜ì´ì§• ê¸°ëŠ¥

> ì°¸ê³  : ì‹¤ë¬´ì—ì„œëŠ” JPA ì™€ ìŠ¤í”„ë§ ë°ì´í„° JPA ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ , ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ëŠ” Querydsl ì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤. Querydsl ì‚¬ìš© ì‹œ ì¿¼ë¦¬ë¥¼ ìë°” ì½”ë“œë¡œ ì•ˆì „í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆê³ , ë™ì  ì¿¼ë¦¬ë„ í¸ë¦¬í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. ì´ì™¸ëŠ” JPA ê°€ ì œê³µí•˜ëŠ” ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, ìŠ¤í”„ë§ JdbcTemplate ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
> 

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# AOP ê°€ í•„ìš”í•œ ìƒí™©

- ëª¨ë“  ë©”ì†Œë“œì˜ í˜¸ì¶œ ì‹œê°„ì„ ì¸¡ì •í•˜ê³  ì‹¶ë‹¤ë©´?

### MemberService íšŒì› ì¡°íšŒ ì‹œê°„ ì¸¡ì • ì½”ë“œ ì¶”ê°€

- src/main/java/hello.hellospring/service/MemberService ì½”ë“œ ì¶”ê°€
```java
...

@Transactional
public class MemberService {

    ...

    // íšŒì› ê°€ì…
    public Long join(Member member) {

        // ì‹œì‘í•  ë•Œ ì‹œê°„ ì¸¡ì •
        long start = System.currentTimeMillis();

        try {
            // ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µ íšŒì› X
            validateDuplicateMember(member); // ì¤‘ë³µ íšŒì› ê²€ì¦
            memberRepository.save(member);
            return member.getId();
        } finally {
            // ëë‚  ë•Œ ì‹œê°„ ì¸¡ì •
            long finish = System.currentTimeMillis();
            long timeMs = finish - start;
            System.out.println("join = " + timeMs + "ms");
        }
    }

    ...

    // ì „ì²´ íšŒì› ì¡°íšŒ
    public List<Member> findMembers() {
        long start = System.currentTimeMillis();
        try {
            return memberRepository.findAll();
        } finally {
            long finish = System.currentTimeMillis();
            long timeMs = finish - start;
            System.out.println("findMembers = " + timeMs + "ms");
        }

    }

    ...
}
```

- í…ŒìŠ¤íŠ¸ í•˜ê¸°

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbsgjRP%2FbtsudROtKs3%2FDkOtHnSkA2VGIAGZyR9eZ1%2Fimg.png)

### ë¬¸ì œì 

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FmCNpP%2FbtsuCGLbYvx%2FPptx7If8mcHYv5XBerEdWk%2Fimg.png)

â†’ ì‹œê°„ ì¸¡ì • ê¸°ëŠ¥ì€ ê³µí†µ ê´€ì‹¬ ì‚¬í•­

â†’ ì‹œê°„ ì¸¡ì • ë¡œì§ê³¼ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì„ì—¬ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›€

â†’ ì‹œê°„ ì¸¡ì • ë¡œì§ì„ ë³„ë„ì˜ ê³µí†µ ë¡œì§ìœ¼ë¡œ ë§Œë“¤ê¸°ëŠ” í˜ë“¦

â†’ ì‹œê°„ ì¸¡ì • ë¡œì§ ë³€ê²½ ì‹œ ëª¨ë“  ë¡œì§ì„ ë³€ê²½í•´ì•¼ í•¨

â¡ï¸ AOP ê°€ í•„ìš” !!

<!----------------------------------------------------------->
<!----------------------------------------------------------->

# AOP ì ìš©

- AOP : Aspect Oriented Programming (ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°)
- ê³µí†µ ê´€ì‹¬ ì‚¬í•­ (cross-cutting concern) vs. í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ (core concern) ë¶„ë¦¬

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FkUsny%2FbtsueN6dR5s%2FfqBseKLsmeINv6hgBKgnuK%2Fimg.png)

### ì‹œê°„ ì¸¡ì • AOP ë“±ë¡

1. MemberService ì— ì¶”ê°€í–ˆë˜ ì‹œê°„ ì¸¡ì • ì½”ë“œ ì‚­ì œ
2. src/main/java/hello.hellospring ì— aop íŒ¨í‚¤ì§€ ìƒì„±
3. ìƒì„±í•œ íŒ¨í‚¤ì§€ ë°‘ì— TimeTraceAop í´ë˜ìŠ¤ ìƒì„±

```java
package hello.hellospring.aop;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect; // AOP ì‚¬ìš©
import org.springframework.stereotype.Component;

@Aspect
@Component
public class TimeTraceAop {

    @Around("execution(* hello.hellospring..*(..))")
    public Object execute(ProceedingJoinPoint joinPoint) throws Throwable {
        long start = System.currentTimeMillis();
        System.out.println("START: " + joinPoint.toString());
        try {
            return joinPoint.proceed();
        } finally {
            long finish = System.currentTimeMillis();
            long timeMs = finish - start;
            System.out.println("END: " + joinPoint.toString() + " " + timeMs + "ms");
        }
    }
}
```

- í…ŒìŠ¤íŠ¸ í•˜ê¸° (íšŒì› ì¡°íšŒ í–ˆì„ ë•Œ)

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcPyNZq%2FbtsuGvWV51W%2FHkAy58oiVrPYARk7l2zS81%2Fimg.png)

â†’ AOP ë¡œ ì‹œê°„ ì¸¡ì • ì™„ë£Œ

### ìŠ¤í”„ë§ AOP ë™ì‘ ë°©ì‹

- AOP ì ìš© ì „ ì˜ì¡´ ê´€ê³„

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FWL77d%2FbtsuG90lkEx%2FCe1k6OTDMomlyJq26Kx1TK%2Fimg.png)

- AOP ì ìš© í›„ ì˜ì¡´ ê´€ê³„

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbDywJt%2FbtsueNkRFGs%2FoRyKNz9UPoHUxxvKrY38xK%2Fimg.png)

â†’ ê°€ì§œ memberService ë¨¼ì € í˜¸ì¶œ (í”„ë¡ì‹œ memberService)

- AOP ì ìš© ì „ ì „ì²´ ê·¸ë¦¼

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbRDs0Q%2FbtsuglON7ba%2Fis6FCwTpw2eM306L4c3A0k%2Fimg.png)

- AOP ì ìš© í›„ ì „ì²´ ê·¸ë¦¼

![Untitled](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FW6Fkd%2FbtsuflO8cAV%2FebGWV6aCMx0MC4oDGAZwXk%2Fimg.png)

### í•´ê²°í•œ ë¬¸ì œ

â†’ í•µì‹¬ ê´€ì‹¬ ì‚¬í•­(íšŒì› ê¸°ëŠ¥) & ê³µí†µ ê´€ì‹¬ ì‚¬í•­(ì‹œê°„ ì¸¡ì • ë¡œì§) ë¶„ë¦¬

â†’ ì‹œê°„ ì¸¡ì • ë¡œì§ì„ ë³„ë„ì˜ ê³µí†µ ë¡œì§ìœ¼ë¡œ ìƒì„± (ì½”ë“œ ë³€ê²½ ìš©ì´)

â†’ ì›í•˜ëŠ” ì ìš© ëŒ€ìƒ ì„ íƒ ê°€ëŠ¥

<!----------------------------------------------------------->
<!----------------------------------------------------------->
